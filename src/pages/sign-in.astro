---
import Layout from '../layouts/main.astro';
import { getAuthUrl } from '@/lib/auth';

const title = 'Sign In - ASIMOV.Systems';
const description = 'Sign in to your ASIMOV account';

// Redirect to id.asimov.nexus for authentication (uses Clerk)
const returnUrl = Astro.url.searchParams.get('returnUrl') || Astro.url.origin;
const authUrl = getAuthUrl(returnUrl);

// Server-side redirect
return Astro.redirect(authUrl, 302);
---

<!-- This should not render if redirect works -->
<Layout title={title} description={description}>
  <div
    class="flex min-h-screen items-center justify-center bg-gradient-to-b from-slate-900 to-slate-950 px-4 py-16"
  >
    <div class="w-full max-w-md text-center">
      <div class="mb-8">
        <h1 class="mb-2 text-4xl font-bold text-white">Welcome Back</h1>
        <p class="text-slate-400">Redirecting to sign in...</p>
        <p class="mt-4 text-xs text-slate-500">
          If you are not redirected, <a href={authUrl} class="text-orange-500 underline"
            >click here</a
          >
        </p>
      </div>
    </div>
  </div>

  <script define:vars={{ authUrl }}>
    // Client-side redirect as immediate fallback
    if (typeof window !== 'undefined') {
      window.location.replace(authUrl);
    }
  </script>
</Layout>
