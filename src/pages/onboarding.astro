---
import Layout from '../layouts/main.astro';
import { OnboardingFlow } from '@/components/OnboardingFlow';
import { clerkClient } from '@clerk/astro/server';

const title = 'Welcome to ASIMOV - Get Started';
const description = 'Complete your onboarding and reserve your ASIMOV identity';

// Get user data server-side
const auth = Astro.locals.auth();
if (!auth.userId) {
  return Astro.redirect('/sign-up');
}

const user = await clerkClient(Astro).users.getUser(auth.userId);
---

<Layout title={title} description={description}>
  <OnboardingFlow 
    user={{
      id: user.id,
      firstName: user.firstName,
      lastName: user.lastName,
      email: user.emailAddresses[0]?.emailAddress || '',
    }}
    client:load 
  />
</Layout>

